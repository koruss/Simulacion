/*
Kenneth Corrales Lizano carnet 2017151342 
Alejandro Tapia Alvarez carnet 2017116952

Solución al costo total para 3 empleados  = 19815.5101
Solución al costo total para 4 empleados  = 21744.062
Solución al costo total para 5 empleados  = 22789.7561
Solución al costo total para 6 empleados  = 22973.7682
		
*/

clearoutput
name Inicio Entrada Salida x Fin
global Inicio Entrada Salida x Fin

newcmd obtenerEntrada tiempo
   exponential 1 40 tiempo
   integer ceiling tiempo tiempo
end

newcmd obtenerSalida promedio tiempo
   exponential 1 promedio tiempo
   integer ceiling tiempo tiempo
end

newcmd tiempoPorTrabajador cTrabajadores tiempo
   c = cTrabajadores * 2
   tiempo = 43 - c
end

newcmd ImprimirFila Tiempo Evento SigSalida SigEntrada TOcioso TEspera Cola
   if SigSalida = x
      output "%7.0F %8.0F \t        %8.0F \t\t\t%27.0F %24.0F %24.0F" Tiempo Evento SigSalida SigEntrada TOcioso TEspera
   else
      output "%7.0F %8.0F  \t%24.0F   %23.0F    %27.0F %24.0F" Tiempo Evento SigSalida SigEntrada TOcioso TEspera
   end
   forEach i Cola
      output " %3.0F" i
   end
   print
end

newcmd imprimirFinal Tiempo
   output "%7.0F Fin" Tiempo
   print
end


/*
Programa Principal
*/

input trabajadores 'Ingrese la cantidad de Personal (3-6):


newcmd main trabajadores costoTotal
   Tiempo = 0
   Evento = Inicio
   SigSalida = x
   TOcioso = 0
   TEsperaBus = 0
   Cola = ()
   atendiendo = 0
   TiempoAnterior = 0
   Salarios = 0
   CostoTiempoOcioso = 0
   CostoEsperaBuses = 0
   CostoOperacionAlmacen = 0
   CostoTotal = 0
   obtenerEntrada SigEntrada
  ' output "Tiempo	Evento		Sig Salida		SigEntrada		T. Ocioso		T.Esp.Bus		Cola"
   print
   tiempoPorTrabajador trabajadores TServicio
'   imprimirFila Tiempo Evento SigSalida SigEntrada TOcioso TEsperaBus Cola
   Tiempo = SigEntrada
   Evento = Entrada
   TOcioso = SigEntrada
   CostoTiempoOcioso = TOcioso
   obtenerEntrada SigEntrada
   SigEntrada = SigEntrada + Tiempo
   obtenerSalida TServicio SigSalida
   SigSalida = SigSalida + Tiempo
   while (Tiempo < 480)
      'imprimirFila Tiempo Evento SigSalida SigEntrada TOcioso TEsperaBus Cola
      if (SigSalida = x)
         if (SigEntrada <= 480)
            TOcioso = SigEntrada - Tiempo
            CostoTiempoOcioso = CostoTiempoOcioso + TOcioso
            Tiempo = SigEntrada
            Evento = Entrada
            obtenerSalida TServicio SigSalida
            SigSalida = SigSalida + Tiempo
            obtenerEntrada SigEntrada
            SigEntrada = SigEntrada + Tiempo
         else
            TOcioso = 480 - Tiempo
            Tiempo = 480
            Evento = Fin
         end
      elseif (SigSalida < SigEntrada)
         TiempoAnterior = Tiempo
         Tiempo = SigSalida
         Evento = Salida
         TOcioso = 0
         size Cola cant
         if (cant > 0)
            Cola = Cola + (Tiempo - TiempoAnterior)
            take Cola 1 TEsperaBus
            CostoEsperaBuses = CostoEsperaBuses + TEsperaBus
            remove Cola 1 Cola
            obtenerSalida TServicio SigSalida
            SigSalida = Tiempo + SigSalida
         else
            SigSalida = x
            atendiendo = 0
            TEsperaBus = 0
         end
      else
         if (SigEntrada <= 480)
            size Cola cant
            if (cant > 0 )
               Cola = Cola + ( SigEntrada - Tiempo)
            end
            Tiempo = SigEntrada
            copy Cola 0 Cola
            obtenerEntrada SigEntrada
            SigEntrada = SigEntrada + Tiempo
            TOcioso = 0
            TEsperaBus = 0
            Evento = Entrada
         else
            TiempoAnterior = Tiempo
            Tiempo = SigSalida
            Evento = Salida
            TOcioso = 0
            size Cola cant
            if (cant > 0)
               Cola = Cola + (Tiempo - TiempoAnterior)
               take Cola 1 TEsperaBus
               CostoEsperaBuses = CostoEsperaBuses + TEsperaBus
               remove Cola 1 Cola
               obtenerSalida TServicio SigSalida
               SigSalida = Tiempo + SigSalida
            else
               SigSalida = x
               atendiendo = 0
               TEsperaBus = 0
            end
         end
      end
   end
   while(SigSalida <> x )
      'imprimirFila Tiempo Evento SigSalida SigEntrada TOcioso TEsperaBus Cola
      TiempoAnterior = Tiempo
      Tiempo = SigSalida
      Evento = Salida
      TOcioso = 0
      size Cola cant
      if (cant > 0)
         Cola = Cola + (Tiempo - TiempoAnterior)
         take Cola 1 TEsperaBus
         CostoEsperaBuses = CostoEsperaBuses + TEsperaBus
         remove Cola 1 Cola
         obtenerSalida TServicio SigSalida
         SigSalida = Tiempo + SigSalida
      else
         SigSalida = x
         atendiendo = 0
         TEsperaBus = 0
      end
   end
  ' imprimirFinal Tiempo
   Salario = 8 *trabajadores * 25 + trabajadores*(Tiempo - 480) *37.50
   CostoTiempoOcioso = trabajadores * (CostoTiempoOcioso / 60 ) * 25
   CostoOperacionAlmacen = (Tiempo / 60) * 500
   CostoEsperaBuses = (CostoEsperaBuses / 60 ) * 100
   CostoTotal = Salario + CostoTiempoOcioso + CostoOperacionAlmacen + CostoEsperaBuses
'PRINT Salario CostoTiempoOcioso  CostoOperacionAlmacen CostoEsperaBuses   CostoTotal 
end


newcmd Experimentos
   iteraciones = 1000000
   temp = iteraciones
   copy 3,6 trabajadores
   copy 4#0 costosTotales
   while (iteraciones > 0)
      pos = 1
      while (pos < 5)
         take trabajadores pos cant
         main cant costoTotal
         take costosTotales pos suma
         suma = suma + costoTotal
         put suma pos costosTotales
         pos = pos + 1
      end
      iteraciones = iteraciones - 1
   end
   costosTotales = costosTotales / temp
   print table trabajadores%10.4F costosTotales%10.4F
   
end

Experimentos
